// Generated by CoffeeScript 1.4.0
(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=function(e,t){return function(){return e.apply(t,arguments)}},r=[].slice;window.FileTemplate='<li class="file <% if(file.complete){ %>complete<% } %>">\n<a href="#" class="destroy">x</a>\n<p class="name"><%= file.name %></p>\n<p class="size"><%= file.size %></p>\n<p class="progress"><%= file.progress %></p>\n<p class="speed"><%= file.speed %></p>\n</li>';window.File=function(e){function n(){n.__super__.constructor.apply(this,arguments);this.complete=!1;this.progress=0}t(n,e);n.configure("File","name","complete","progress","speed","swf_id");return n}(Spine.Model);window.Upload=function(e){function r(){this.render=n(this.render,this);r.__super__.constructor.apply(this,arguments);this.item.bind("update",this.render);this.item.bind("destroy",this.release)}t(r,e);r.prototype.events={"click	.destroy":"remove"};r.prototype.template=function(e){return _.template(window.FileTemplate,{file:e})};r.prototype.render=function(){this.replace(this.template(this.item));return this};r.prototype.remove=function(e){e.preventDefault();return this.item.destroy()};return r}(Spine.Controller);window.Asset=function(e){function n(){n.__super__.constructor.apply(this,arguments)}t(n,e);n.configure("Asset","path","full_path");n.extend(Spine.Model.Ajax);n.url="http://uploader.dev/assets";return n}(Spine.Model);window.Uploader=function(e){function i(e){e==null&&(e={});this.complete_upload=n(this.complete_upload,this);this.remove_upload=n(this.remove_upload,this);this.add_upload=n(this.add_upload,this);i.__super__.constructor.apply(this,arguments);this.options=e;this.bind("upload_error",this.upload_error);this.bind("complete_upload",this.complete_upload);this.bind("update_upload",this.update_upload);File.bind("create",this.add_upload);File.bind("destroy",this.remove_upload);this.defaults={fallback_id:"file_select",post_url:"/assets",post_param:"file",max_files:1e3,max_file_size:3e3,post_data:{},post_headers:{}};typeof FileReader!="undefined"&&"draggable"in document.createElement("span")?this.use_upchunk(this.defaults,this.options):swfobject.hasFlashPlayerVersion("9.0.24")&&this.use_swfupload(this.defaults,this.options)}t(i,e);i.prototype.elements={"#global_progress":"global_progress","#upload_list":"upload_list"};i.prototype.add_upload=function(e){var t;t=new Upload({item:e});return this.upload_list.append(t.render().el)};i.prototype.remove_upload=function(e){if(e.swf_id&&this.swf_upload&&!e.complete)return this.swf_upload.cancelUpload(e.swf_id,!1)};i.prototype.update_upload=function(e){};i.prototype.complete_upload=function(e){var t;t=Asset.refresh(e.asset);return File.destroy(e.file.id)};i.prototype.upload_error=function(e){switch(e){case"BrowserNotSupported":return console.log("browser not supported");case"TooManyFiles":return console.log("too many files");case"FileTooLarge":return console.log("file too large");case"FileTypeNotAllowed":return console.log("file type not allowed");case"ZERO_BYTE_FILE":return console.log("empty files are not allowed");default:return console.log("generic error")}};i.prototype.update_global_progress=function(e){return this.global_progress.width(""+e+"%")};i.prototype.use_upchunk=function(e,t){var n=this;e==null&&(e={});t==null&&(t={});return $(document).upchunk({fallback_id:t.fallback_id||e.fallback_id,url:t.post_url||e.post_url,file_param:t.post_param||e.post_param,max_file_size:t.max_file_size||e.max_file_size,data:t.post_data||e.post_data||{},headers:t.post_headers||e.post_headers||{},queue_size:3,docEnter:function(){},docLeave:function(){},beforeEach:function(r){if(File.count()>=(t.max_files||e.max_files)){n.trigger("upload_error",{error:"TooManyFiles",file:r});return!1}},uploadStarted:function(e,t){return File.create({name:e.name,size:e.size})},progressUpdated:function(e,t,r){var i;i=File.findByAttribute("name",e.name);i.progress=r;i.save();return n.trigger("update_upload",{file:e,progress:r})},uploadFinished:function(e,t,r){var i;i=File.findByAttribute("name",e.name);if(r){i.progress=100;i.complete=!0;i.save();return n.trigger("complete_upload",{file:i,asset:r})}i.destroy();return n.trigger("upload_error",{error:"unknown"})},error:function(e){return n.trigger("upload_error",{error:e})}})};i.prototype.use_swfupload=function(e,t){var n=this;e==null&&(e={});t==null&&(t={});return this.swf_upload=new SWFUpload({flash_url:"/javascripts/vendor/swfupload/swfupload.swf",button_width:61,button_height:22,button_placeholder_id:t.fallback_id||e.fallback_id,upload_url:t.post_url||e.post_url,file_post_name:t.post_param||e.post_param,file_upload_limit:999,file_size_limit:t.max_file_size||e.max_file_size,post_params:t.post_data||e.post_data,debug:!0,file_queue_error_handler:function(e,t,r){r=_.invert(SWFUpload.QUEUE_ERROR)[t];return n.trigger("upload_error",{error:r,file:e})},upload_start_handler:function(r){if(File.count()>=(t.max_files||e.max_files)){n.trigger("upload_error",{error:"TooManyFiles",file:r});return!1}if(r)return File.create({name:r.name,size:r.size,swf_id:r.id})},upload_progress_handler:function(e,t,r){var i;i=File.findByAttribute("name",e.name);i.progress=t/r*100;i.save();return n.trigger("update_upload",{file:e,progress:t/r*100})},upload_success_handler:function(e){var t;t=File.findByAttribute("name",e.name);t.progress=100;t.complete=!0;t.save();return n.trigger("update_complete",{file:e})},upload_error_handler:function(e,t,r){var i;if(e){i=File.findByAttribute("name",e.name);i.destroy();r=_.invert(SWFUpload.UPLOAD_ERROR)[t];return n.trigger("upload_error",{error:r,file:e})}},file_dialog_complete_handler:function(){var e;e=1<=arguments.length?r.call(arguments,0):[];return n.swf_upload.startUpload()}})};return i}(Spine.Controller)}).call(this);